WITH IDADE AS (
    SELECT DATEDIFF(YYYY, CONVERT(DATETIME, BA1_DATNAS, 03), GETDATE()) AS IDADE, *
    FROM BA1020 (NOLOCK)
    WHERE BA1_CODEMP BETWEEN '0001' AND '0002'
      AND BA1_DATINC <= '20230310'
      AND (BA1_MOTBLO IN ('', '004') OR BA1_DATBLO > '20230310' OR (BA1_MOTBLO <> '' AND BA1_DATBLO = '20230310'))
      AND D_E_L_E_T_ = ''
)
SELECT
    CASE
        WHEN IDADE BETWEEN 0 AND 18 THEN '0 A 18 ANOS'
        WHEN IDADE BETWEEN 19 AND 23 THEN '19 A 23 ANOS'
        WHEN IDADE BETWEEN 24 AND 28 THEN '24 A 28 ANOS'
        WHEN IDADE BETWEEN 29 AND 33 THEN '29 A 33 ANOS'
        WHEN IDADE BETWEEN 34 AND 38 THEN '34 A 38 ANOS'
        WHEN IDADE BETWEEN 39 AND 43 THEN '39 A 43 ANOS'
        WHEN IDADE BETWEEN 44 AND 48 THEN '44 A 48 ANOS'
        WHEN IDADE BETWEEN 49 AND 53 THEN '49 A 53 ANOS'
        WHEN IDADE BETWEEN 54 AND 58 THEN '54 A 58 ANOS'
        WHEN IDADE >= 59 THEN '59 ANOS OU MAIS'
    END AS FAIXA,
    COUNT(*) AS VIDAS
FROM IDADE
    INNER JOIN BI3020 BI3 (NOLOCK) ON (BA1_CODPLA = BI3_CODIGO AND BA1_VERSAO = BI3_VERSAO)
WHERE BI3_SUSEP BETWEEN '         ' AND 'ZZZZZZZZZ'
    AND BI3.D_E_L_E_T_ = ''
GROUP BY  
    CASE
        WHEN IDADE BETWEEN 0 AND 18 THEN '0 A 18 ANOS'
        WHEN IDADE BETWEEN 19 AND 23 THEN '19 A 23 ANOS'
        WHEN IDADE BETWEEN 24 AND 28 THEN '24 A 28 ANOS'
        WHEN IDADE BETWEEN 29 AND 33 THEN '29 A 33 ANOS'
        WHEN IDADE BETWEEN 34 AND 38 THEN '34 A 38 ANOS'
        WHEN IDADE BETWEEN 39 AND 43 THEN '39 A 43 ANOS'
        WHEN IDADE BETWEEN 44 AND 48 THEN '44 A 48 ANOS'
        WHEN IDADE BETWEEN 49 AND 53 THEN '49 A 53 ANOS'
        WHEN IDADE BETWEEN 54 AND 58 THEN '54 A 58 ANOS'
        WHEN IDADE >= 59 THEN '59 ANOS OU MAIS'
    END
ORDER BY FAIXA;
